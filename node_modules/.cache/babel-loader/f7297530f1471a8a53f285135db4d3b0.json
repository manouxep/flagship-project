{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useFlagshipContext = exports.FlagshipConsumer = exports.FlagshipProvider = exports.initState = void 0;\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar js_sdk_1 = __importDefault(require(\"@flagship.io/js-sdk\"));\n\nvar use_ssr_1 = __importDefault(require(\"use-ssr\"));\n\nvar loggerHelper_1 = __importDefault(require(\"./lib/loggerHelper\"));\n\nvar FlagshipErrorBoundary_1 = __importDefault(require(\"./FlagshipErrorBoundary\"));\n\nvar utils_1 = require(\"./lib/utils\");\n\nexports.initState = {\n  fsSdk: null,\n  fsVisitor: null,\n  log: null,\n  fsModifications: null,\n  status: {\n    isLoading: true,\n    isSdkReady: false,\n    isVisitorDefined: false,\n    firstInitSuccess: null,\n    lastRefresh: null,\n    hasError: false\n  },\n  private: {\n    previousFetchedModifications: undefined\n  }\n};\nvar FlagshipContext = react_1.default.createContext({\n  state: __assign({}, exports.initState),\n  setState: null,\n  hasError: false\n});\n\nexports.FlagshipProvider = function (_a) {\n  var children = _a.children,\n      reactNative = _a.reactNative,\n      envId = _a.envId,\n      visitorData = _a.visitorData,\n      loadingComponent = _a.loadingComponent,\n      initialModifications = _a.initialModifications,\n      initialBucketing = _a.initialBucketing,\n      onSavingModificationsInCache = _a.onSavingModificationsInCache,\n      onInitStart = _a.onInitStart,\n      onInitDone = _a.onInitDone,\n      onBucketingSuccess = _a.onBucketingSuccess,\n      onBucketingFail = _a.onBucketingFail,\n      onUpdate = _a.onUpdate,\n      timeout = _a.timeout,\n      fetchNow = _a.fetchNow,\n      activateNow = _a.activateNow,\n      enableConsoleLogs = _a.enableConsoleLogs,\n      enableErrorLayout = _a.enableErrorLayout,\n      enableSafeMode = _a.enableSafeMode,\n      nodeEnv = _a.nodeEnv,\n      flagshipApi = _a.flagshipApi,\n      apiKey = _a.apiKey,\n      decisionMode = _a.decisionMode,\n      pollingInterval = _a.pollingInterval;\n  var id = visitorData.id,\n      context = visitorData.context;\n\n  var _b = use_ssr_1.default(),\n      isBrowser = _b.isBrowser,\n      isServer = _b.isServer,\n      isNative = _b.isNative;\n\n  var isJest = utils_1.areWeTestingWithJest();\n\n  var extractConfiguration = function extractConfiguration() {\n    var configV2 = {\n      fetchNow: typeof fetchNow !== 'boolean' ? true : fetchNow,\n      decisionMode: decisionMode || 'API',\n      pollingInterval: pollingInterval || null,\n      activateNow: typeof activateNow !== 'boolean' ? false : activateNow,\n      timeout: typeof timeout !== 'number' ? undefined : timeout,\n      enableConsoleLogs: typeof enableConsoleLogs !== 'boolean' ? false : enableConsoleLogs,\n      enableErrorLayout: typeof enableErrorLayout !== 'boolean' ? false : enableErrorLayout,\n      enableSafeMode: typeof enableSafeMode !== 'boolean' ? false : enableSafeMode,\n      nodeEnv: nodeEnv || 'production',\n      initialBucketing: initialBucketing || null,\n      flagshipApi: flagshipApi,\n      apiKey: apiKey\n    };\n    return configV2;\n  };\n\n  var configuration = extractConfiguration();\n\n  var _c = react_1.useState(__assign(__assign({}, exports.initState), {\n    log: loggerHelper_1.default.getLogger(configuration),\n    config: configuration,\n    private: __assign(__assign({}, exports.initState.private), {\n      previousFetchedModifications: initialModifications\n    })\n  })),\n      state = _c[0],\n      setState = _c[1];\n\n  var _d = react_1.useState({\n    hasError: false,\n    error: null\n  }),\n      errorData = _d[0],\n      setError = _d[1];\n\n  var _e = state.status,\n      isLoading = _e.isLoading,\n      isVisitorDefined = _e.isVisitorDefined,\n      firstInitSuccess = _e.firstInitSuccess,\n      lastRefresh = _e.lastRefresh,\n      fsVisitor = state.fsVisitor;\n\n  var tryCatchCallback = function tryCatchCallback(callback) {\n    try {\n      callback();\n    } catch (error) {\n      state.log.fatal(\"error: \" + error.stack);\n      setError({\n        error: error,\n        hasError: true\n      });\n    }\n  };\n\n  var computeConfig = function computeConfig() {\n    var sdkConfig = {\n      internal: {\n        react: {},\n        reactNative: {\n          httpCallback: reactNative === null || reactNative === void 0 ? void 0 : reactNative.httpCallback\n        }\n      }\n    };\n\n    if (Array.isArray(state.private.previousFetchedModifications)) {\n      return __assign(__assign(__assign({}, configuration), sdkConfig), {\n        initialModifications: __spreadArrays(state.private.previousFetchedModifications)\n      });\n    }\n\n    if (state.private.previousFetchedModifications) {\n      state.log.warn('initialModifications props is not correctly set and has been ignored, please check the documentation.');\n    }\n\n    return __assign(__assign({}, configuration), sdkConfig);\n  };\n\n  var computedConfig = computeConfig();\n  var handleErrorDisplay = reactNative === null || reactNative === void 0 ? void 0 : reactNative.handleErrorDisplay;\n\n  var initSdk = function initSdk(previousBucketing) {\n    var theApiKey = computedConfig.apiKey,\n        otherComputedConfig = __rest(computedConfig, [\"apiKey\"]);\n\n    return js_sdk_1.default.start(envId, theApiKey, __assign(__assign({}, otherComputedConfig), {\n      fetchNow: isServer ? false : otherComputedConfig.fetchNow,\n      initialBucketing: computedConfig.initialBucketing === null ? previousBucketing : computedConfig.initialBucketing\n    }));\n  };\n\n  var postInitSdkForClientSide = function postInitSdkForClientSide(fsSdk) {\n    var _a, _b, _c;\n\n    fsSdk.eventEmitter.on('bucketPollingSuccess', function (_a) {\n      var status = _a.status,\n          payload = _a.payload;\n\n      if (onBucketingSuccess) {\n        onBucketingSuccess({\n          status: status.toString(),\n          payload: payload\n        });\n      }\n    });\n    fsSdk.eventEmitter.on('bucketPollingFailed', function (error) {\n      if (onBucketingFail) {\n        onBucketingFail(error);\n      }\n    });\n    var visitorInstance;\n    var newVisitorDetected = true;\n\n    if (onInitStart && !isVisitorDefined) {\n      tryCatchCallback(onInitStart);\n    }\n\n    if ((state === null || state === void 0 ? void 0 : state.fsVisitor) && state.fsVisitor.envId === fsSdk.envId && state.fsVisitor.id === id) {\n      if (state.fsVisitor.context !== context) {\n        state.log.debug(\"update visitor after re-render, but context is different (old vs new): vContext (\" + JSON.stringify((_a = state.fsVisitor) === null || _a === void 0 ? void 0 : _a.context) + \" vs \" + JSON.stringify(context) + \")\");\n      } else {\n        state.log.debug(\"update visitor after re-render\");\n      }\n\n      newVisitorDetected = false;\n      visitorInstance = fsSdk.updateVisitor(state.fsVisitor, context);\n    } else {\n      if (state === null || state === void 0 ? void 0 : state.fsVisitor) {\n        state.log.debug(\"unable to update visitor after re-render because of strong update (old vs new): envId (\" + ((_b = state.fsVisitor) === null || _b === void 0 ? void 0 : _b.envId) + \" vs \" + fsSdk.envId + \") or vId (\" + ((_c = state.fsVisitor) === null || _c === void 0 ? void 0 : _c.id) + \" vs \" + id + \")\");\n      }\n\n      visitorInstance = fsSdk.newVisitor(id, context);\n      newVisitorDetected = true;\n    }\n\n    setState(function (s) {\n      return __assign(__assign({}, s), {\n        status: __assign(__assign({}, s.status), {\n          isVisitorDefined: !!visitorInstance,\n          isLoading: true\n        }),\n        fsVisitor: visitorInstance,\n        fsModifications: visitorInstance.fetchedModifications || null,\n        fsSdk: fsSdk\n      });\n    });\n    visitorInstance.on('ready', function () {\n      var firstInitSuccessOldValue = firstInitSuccess;\n      setState(function (s) {\n        return __assign(__assign({}, s), {\n          status: __assign(__assign({}, s.status), {\n            isVisitorDefined: !!visitorInstance,\n            isLoading: false,\n            lastRefresh: new Date().toISOString(),\n            firstInitSuccess: !newVisitorDetected && s.status.firstInitSuccess || new Date().toISOString()\n          }),\n          fsVisitor: visitorInstance,\n          fsSdk: fsSdk,\n          fsModifications: visitorInstance.fetchedModifications || null,\n          private: {\n            previousFetchedModifications: visitorInstance.fetchedModifications || undefined\n          }\n        });\n      });\n    });\n    visitorInstance.on('saveCache', function (args) {\n      if (onSavingModificationsInCache) {\n        tryCatchCallback(function () {\n          return onSavingModificationsInCache(args);\n        });\n      }\n    });\n  };\n\n  if (!isJest && isServer && !isVisitorDefined) {\n    state.log.debug(\"SDK run on server side detected.\");\n    var fsSdk_1 = initSdk();\n    var visitorInstance_1 = fsSdk_1.newVisitor(id, context);\n    setState(function (s) {\n      return __assign(__assign({}, s), {\n        status: __assign(__assign({}, s.status), {\n          isVisitorDefined: !!visitorInstance_1\n        }),\n        fsVisitor: visitorInstance_1,\n        fsModifications: visitorInstance_1.fetchedModifications || null,\n        fsSdk: fsSdk_1\n      });\n    });\n  } else if ((isJest || isNative || isBrowser) && !isVisitorDefined && firstInitSuccess === null) {\n    var fsSdk = initSdk();\n    postInitSdkForClientSide(fsSdk);\n  }\n\n  react_1.useEffect(function () {\n    var _a;\n\n    if (!isBrowser) {\n      state.log.debug(\"useEffect triggered in an environment other than browser, SDK stopped.\");\n      return;\n    }\n\n    var previousBucketing = null;\n\n    if (state.fsSdk && state.fsSdk.config.decisionMode === 'Bucketing') {\n      state.fsSdk.stopBucketingPolling();\n      state.log.info('Bucketing automatically stopped because a setting props from FlagshipProvider has changed. Bucketing will restart automatically if decisionMode is still \"Bucketing\"');\n      state.fsSdk.eventEmitter.removeAllListeners();\n      previousBucketing = ((_a = state.fsSdk.bucket) === null || _a === void 0 ? void 0 : _a.data) || null;\n    }\n\n    var fsSdk = initSdk(previousBucketing);\n    postInitSdkForClientSide(fsSdk);\n  }, [envId, id, JSON.stringify(configuration) + JSON.stringify(context)]);\n  react_1.useEffect(function () {\n    var isSdkReady = state.status.isVisitorDefined && state.status.firstInitSuccess !== null;\n\n    if (onUpdate) {\n      tryCatchCallback(function () {\n        var _a;\n\n        onUpdate({\n          status: __assign(__assign({}, state.status), {\n            isSdkReady: isSdkReady\n          }),\n          fsModifications: state.fsModifications,\n          config: __assign(__assign({}, state.config), (_a = state.fsVisitor) === null || _a === void 0 ? void 0 : _a.config)\n        }, state.fsVisitor);\n      });\n    }\n  }, [state === null || state === void 0 ? void 0 : state.config, state === null || state === void 0 ? void 0 : state.fsModifications, state.status.isVisitorDefined]);\n  react_1.useEffect(function () {\n    if (onInitDone && !!firstInitSuccess && firstInitSuccess === lastRefresh && !isLoading) {\n      tryCatchCallback(onInitDone);\n    }\n  }, [state === null || state === void 0 ? void 0 : state.status]);\n\n  var handleDisplay = function handleDisplay() {\n    var isFirstInit = !fsVisitor || !firstInitSuccess;\n\n    if (isLoading && loadingComponent && isFirstInit && fetchNow) {\n      return react_1.default.createElement(react_1.default.Fragment, null, loadingComponent);\n    }\n\n    return react_1.default.createElement(react_1.default.Fragment, null, children);\n  };\n\n  var handleError = function handleError(error) {\n    state.log.fatal(\"error: \" + error.stack);\n    setError({\n      error: error,\n      hasError: !!error\n    });\n  };\n\n  return react_1.default.createElement(FlagshipContext.Provider, {\n    value: {\n      state: state,\n      setState: setState,\n      hasError: errorData.hasError\n    }\n  }, enableSafeMode ? react_1.default.createElement(FlagshipErrorBoundary_1.default, {\n    customerChildren: children,\n    onError: handleError,\n    error: errorData.error,\n    sdkSettings: configuration,\n    handleDisplay: handleErrorDisplay,\n    log: state.log\n  }, handleDisplay()) : handleDisplay());\n};\n\nexports.FlagshipProvider.defaultProps = {\n  loadingComponent: undefined,\n  fetchNow: true,\n  activateNow: false,\n  decisionMode: 'API',\n  pollingInterval: undefined,\n  enableConsoleLogs: false,\n  enableErrorLayout: false,\n  enableSafeMode: false,\n  nodeEnv: 'production',\n  flagshipApi: undefined,\n  apiKey: undefined,\n  initialModifications: undefined,\n  onInitStart: function onInitStart() {},\n  onInitDone: function onInitDone() {},\n  onSavingModificationsInCache: function onSavingModificationsInCache() {},\n  onUpdate: function onUpdate() {}\n};\nexports.FlagshipConsumer = FlagshipContext.Consumer;\nexports.default = FlagshipContext;\n\nexports.useFlagshipContext = function () {\n  return react_1.useContext(FlagshipContext);\n};","map":{"version":3,"sources":["../src/FlagshipContext.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useFlagshipContext = exports.FlagshipConsumer = exports.FlagshipProvider = exports.initState = void 0;\nvar react_1 = __importStar(require(\"react\"));\nvar js_sdk_1 = __importDefault(require(\"@flagship.io/js-sdk\"));\nvar use_ssr_1 = __importDefault(require(\"use-ssr\"));\nvar loggerHelper_1 = __importDefault(require(\"./lib/loggerHelper\"));\nvar FlagshipErrorBoundary_1 = __importDefault(require(\"./FlagshipErrorBoundary\"));\nvar utils_1 = require(\"./lib/utils\");\nexports.initState = {\n    fsSdk: null,\n    fsVisitor: null,\n    log: null,\n    fsModifications: null,\n    status: {\n        isLoading: true,\n        isSdkReady: false,\n        isVisitorDefined: false,\n        firstInitSuccess: null,\n        lastRefresh: null,\n        hasError: false\n    },\n    private: {\n        previousFetchedModifications: undefined\n    }\n};\nvar FlagshipContext = react_1.default.createContext({ state: __assign({}, exports.initState), setState: null, hasError: false });\nexports.FlagshipProvider = function (_a) {\n    var children = _a.children, reactNative = _a.reactNative, envId = _a.envId, visitorData = _a.visitorData, loadingComponent = _a.loadingComponent, initialModifications = _a.initialModifications, initialBucketing = _a.initialBucketing, onSavingModificationsInCache = _a.onSavingModificationsInCache, onInitStart = _a.onInitStart, onInitDone = _a.onInitDone, onBucketingSuccess = _a.onBucketingSuccess, onBucketingFail = _a.onBucketingFail, onUpdate = _a.onUpdate, timeout = _a.timeout, fetchNow = _a.fetchNow, activateNow = _a.activateNow, enableConsoleLogs = _a.enableConsoleLogs, enableErrorLayout = _a.enableErrorLayout, enableSafeMode = _a.enableSafeMode, nodeEnv = _a.nodeEnv, flagshipApi = _a.flagshipApi, apiKey = _a.apiKey, decisionMode = _a.decisionMode, pollingInterval = _a.pollingInterval;\n    var id = visitorData.id, context = visitorData.context;\n    var _b = use_ssr_1.default(), isBrowser = _b.isBrowser, isServer = _b.isServer, isNative = _b.isNative;\n    var isJest = utils_1.areWeTestingWithJest();\n    var extractConfiguration = function () {\n        var configV2 = {\n            fetchNow: typeof fetchNow !== 'boolean' ? true : fetchNow,\n            decisionMode: decisionMode || 'API',\n            pollingInterval: pollingInterval || null,\n            activateNow: typeof activateNow !== 'boolean' ? false : activateNow,\n            timeout: typeof timeout !== 'number' ? undefined : timeout,\n            enableConsoleLogs: typeof enableConsoleLogs !== 'boolean' ? false : enableConsoleLogs,\n            enableErrorLayout: typeof enableErrorLayout !== 'boolean' ? false : enableErrorLayout,\n            enableSafeMode: typeof enableSafeMode !== 'boolean' ? false : enableSafeMode,\n            nodeEnv: nodeEnv || 'production',\n            initialBucketing: initialBucketing || null,\n            flagshipApi: flagshipApi,\n            apiKey: apiKey\n        };\n        return configV2;\n    };\n    var configuration = extractConfiguration();\n    var _c = react_1.useState(__assign(__assign({}, exports.initState), { log: loggerHelper_1.default.getLogger(configuration), config: configuration, private: __assign(__assign({}, exports.initState.private), { previousFetchedModifications: initialModifications }) })), state = _c[0], setState = _c[1];\n    var _d = react_1.useState({ hasError: false, error: null }), errorData = _d[0], setError = _d[1];\n    var _e = state.status, isLoading = _e.isLoading, isVisitorDefined = _e.isVisitorDefined, firstInitSuccess = _e.firstInitSuccess, lastRefresh = _e.lastRefresh, fsVisitor = state.fsVisitor;\n    var tryCatchCallback = function (callback) {\n        try {\n            callback();\n        }\n        catch (error) {\n            state.log.fatal(\"error: \" + error.stack);\n            setError({ error: error, hasError: true });\n        }\n    };\n    var computeConfig = function () {\n        var sdkConfig = {\n            internal: {\n                react: {},\n                reactNative: {\n                    httpCallback: reactNative === null || reactNative === void 0 ? void 0 : reactNative.httpCallback\n                }\n            }\n        };\n        if (Array.isArray(state.private.previousFetchedModifications)) {\n            return __assign(__assign(__assign({}, configuration), sdkConfig), { initialModifications: __spreadArrays(state.private.previousFetchedModifications) });\n        }\n        if (state.private.previousFetchedModifications) {\n            state.log.warn('initialModifications props is not correctly set and has been ignored, please check the documentation.');\n        }\n        return __assign(__assign({}, configuration), sdkConfig);\n    };\n    var computedConfig = computeConfig();\n    var handleErrorDisplay = reactNative === null || reactNative === void 0 ? void 0 : reactNative.handleErrorDisplay;\n    var initSdk = function (previousBucketing) {\n        var theApiKey = computedConfig.apiKey, otherComputedConfig = __rest(computedConfig, [\"apiKey\"]);\n        return js_sdk_1.default.start(envId, theApiKey, __assign(__assign({}, otherComputedConfig), { fetchNow: isServer ? false : otherComputedConfig.fetchNow, initialBucketing: computedConfig.initialBucketing === null ? previousBucketing : computedConfig.initialBucketing }));\n    };\n    var postInitSdkForClientSide = function (fsSdk) {\n        var _a, _b, _c;\n        fsSdk.eventEmitter.on('bucketPollingSuccess', function (_a) {\n            var status = _a.status, payload = _a.payload;\n            if (onBucketingSuccess) {\n                onBucketingSuccess({ status: status.toString(), payload: payload });\n            }\n        });\n        fsSdk.eventEmitter.on('bucketPollingFailed', function (error) {\n            if (onBucketingFail) {\n                onBucketingFail(error);\n            }\n        });\n        var visitorInstance;\n        var newVisitorDetected = true;\n        if (onInitStart && !isVisitorDefined) {\n            tryCatchCallback(onInitStart);\n        }\n        if ((state === null || state === void 0 ? void 0 : state.fsVisitor) && state.fsVisitor.envId === fsSdk.envId && state.fsVisitor.id === id) {\n            if (state.fsVisitor.context !== context) {\n                state.log.debug(\"update visitor after re-render, but context is different (old vs new): vContext (\" + JSON.stringify((_a = state.fsVisitor) === null || _a === void 0 ? void 0 : _a.context) + \" vs \" + JSON.stringify(context) + \")\");\n            }\n            else {\n                state.log.debug(\"update visitor after re-render\");\n            }\n            newVisitorDetected = false;\n            visitorInstance = fsSdk.updateVisitor(state.fsVisitor, context);\n        }\n        else {\n            if (state === null || state === void 0 ? void 0 : state.fsVisitor) {\n                state.log.debug(\"unable to update visitor after re-render because of strong update (old vs new): envId (\" + ((_b = state.fsVisitor) === null || _b === void 0 ? void 0 : _b.envId) + \" vs \" + fsSdk.envId + \") or vId (\" + ((_c = state.fsVisitor) === null || _c === void 0 ? void 0 : _c.id) + \" vs \" + id + \")\");\n            }\n            visitorInstance = fsSdk.newVisitor(id, context);\n            newVisitorDetected = true;\n        }\n        setState(function (s) { return (__assign(__assign({}, s), { status: __assign(__assign({}, s.status), { isVisitorDefined: !!visitorInstance, isLoading: true }), fsVisitor: visitorInstance, fsModifications: visitorInstance.fetchedModifications || null, fsSdk: fsSdk })); });\n        visitorInstance.on('ready', function () {\n            var firstInitSuccessOldValue = firstInitSuccess;\n            setState(function (s) { return (__assign(__assign({}, s), { status: __assign(__assign({}, s.status), { isVisitorDefined: !!visitorInstance, isLoading: false, lastRefresh: new Date().toISOString(), firstInitSuccess: (!newVisitorDetected && s.status.firstInitSuccess) || new Date().toISOString() }), fsVisitor: visitorInstance, fsSdk: fsSdk, fsModifications: visitorInstance.fetchedModifications || null, private: {\n                    previousFetchedModifications: visitorInstance.fetchedModifications || undefined\n                } })); });\n        });\n        visitorInstance.on('saveCache', function (args) {\n            if (onSavingModificationsInCache) {\n                tryCatchCallback(function () { return onSavingModificationsInCache(args); });\n            }\n        });\n    };\n    if (!isJest && isServer && !isVisitorDefined) {\n        state.log.debug(\"SDK run on server side detected.\");\n        var fsSdk_1 = initSdk();\n        var visitorInstance_1 = fsSdk_1.newVisitor(id, context);\n        setState(function (s) { return (__assign(__assign({}, s), { status: __assign(__assign({}, s.status), { isVisitorDefined: !!visitorInstance_1 }), fsVisitor: visitorInstance_1, fsModifications: visitorInstance_1.fetchedModifications || null, fsSdk: fsSdk_1 })); });\n    }\n    else if ((isJest || isNative || isBrowser) && !isVisitorDefined && firstInitSuccess === null) {\n        var fsSdk = initSdk();\n        postInitSdkForClientSide(fsSdk);\n    }\n    react_1.useEffect(function () {\n        var _a;\n        if (!isBrowser) {\n            state.log.debug(\"useEffect triggered in an environment other than browser, SDK stopped.\");\n            return;\n        }\n        var previousBucketing = null;\n        if (state.fsSdk && state.fsSdk.config.decisionMode === 'Bucketing') {\n            state.fsSdk.stopBucketingPolling();\n            state.log.info('Bucketing automatically stopped because a setting props from FlagshipProvider has changed. Bucketing will restart automatically if decisionMode is still \"Bucketing\"');\n            state.fsSdk.eventEmitter.removeAllListeners();\n            previousBucketing = ((_a = state.fsSdk.bucket) === null || _a === void 0 ? void 0 : _a.data) || null;\n        }\n        var fsSdk = initSdk(previousBucketing);\n        postInitSdkForClientSide(fsSdk);\n    }, [envId, id, JSON.stringify(configuration) + JSON.stringify(context)]);\n    react_1.useEffect(function () {\n        var isSdkReady = state.status.isVisitorDefined && state.status.firstInitSuccess !== null;\n        if (onUpdate) {\n            tryCatchCallback(function () {\n                var _a;\n                onUpdate({\n                    status: __assign(__assign({}, state.status), { isSdkReady: isSdkReady }),\n                    fsModifications: state.fsModifications,\n                    config: __assign(__assign({}, state.config), (_a = state.fsVisitor) === null || _a === void 0 ? void 0 : _a.config)\n                }, state.fsVisitor);\n            });\n        }\n    }, [state === null || state === void 0 ? void 0 : state.config, state === null || state === void 0 ? void 0 : state.fsModifications, state.status.isVisitorDefined]);\n    react_1.useEffect(function () {\n        if (onInitDone && !!firstInitSuccess && firstInitSuccess === lastRefresh && !isLoading) {\n            tryCatchCallback(onInitDone);\n        }\n    }, [state === null || state === void 0 ? void 0 : state.status]);\n    var handleDisplay = function () {\n        var isFirstInit = !fsVisitor || !firstInitSuccess;\n        if (isLoading && loadingComponent && isFirstInit && fetchNow) {\n            return react_1.default.createElement(react_1.default.Fragment, null, loadingComponent);\n        }\n        return react_1.default.createElement(react_1.default.Fragment, null, children);\n    };\n    var handleError = function (error) {\n        state.log.fatal(\"error: \" + error.stack);\n        setError({ error: error, hasError: !!error });\n    };\n    return (react_1.default.createElement(FlagshipContext.Provider, { value: { state: state, setState: setState, hasError: errorData.hasError } }, enableSafeMode ? (react_1.default.createElement(FlagshipErrorBoundary_1.default, { customerChildren: children, onError: handleError, error: errorData.error, sdkSettings: configuration, handleDisplay: handleErrorDisplay, log: state.log }, handleDisplay())) : (handleDisplay())));\n};\nexports.FlagshipProvider.defaultProps = {\n    loadingComponent: undefined,\n    fetchNow: true,\n    activateNow: false,\n    decisionMode: 'API',\n    pollingInterval: undefined,\n    enableConsoleLogs: false,\n    enableErrorLayout: false,\n    enableSafeMode: false,\n    nodeEnv: 'production',\n    flagshipApi: undefined,\n    apiKey: undefined,\n    initialModifications: undefined,\n    onInitStart: function () {\n    },\n    onInitDone: function () {\n    },\n    onSavingModificationsInCache: function () {\n    },\n    onUpdate: function () {\n    }\n};\nexports.FlagshipConsumer = FlagshipContext.Consumer;\nexports.default = FlagshipContext;\nexports.useFlagshipContext = function () { return react_1.useContext(FlagshipContext); };\n//# sourceMappingURL=FlagshipContext.js.map"]},"metadata":{},"sourceType":"script"}